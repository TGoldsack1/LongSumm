{
  "sections": [{
    "heading": "1. Introduction",
    "text": "Neural networks have been the driving force behind the success of deep learning applications. Given enough training data they are able to robustly model input-output relationships and as a result provide high predictive accuracy. However, they do have some drawbacks. In the absence of enough data they tend to overfit considerably; this restricts them from being applied in scenarios were labeled data are scarce, e.g. in medical applications such as MRI classification. Even more importantly, deep neural networks trained with maximum likelihood or MAP procedures tend to be overconfident and as a result do not provide accurate confidence intervals, particularly for inputs that are far from the training data distribution. A simple example can be seen at Figure 1a; the predictive distribution becomes overly overconfident, i.e. assigns a high softmax probability, towards the wrong class for things it hasn’t seen before (e.g. an MNIST 3 rotated by 90 degrees). This in effect makes them unsuitable for applications where decisions are made, e.g.\n1University of Amsterdam, Netherlands 2TNO Intelligent Imaging, Netherlands 3Canadian Institute For Advanced Research (CIFAR). Correspondence to: Christos Louizos <c.louizos@uva.nl>.\nProceedings of the 34 th International Conference on Machine Learning, Sydney, Australia, PMLR 70, 2017. Copyright 2017 by the author(s).\nwhen a doctor determines the disease of a patient based on the output of such a network.\nA principled approach to address both of the aforementioned shortcomings is through a Bayesian inference procedure. Under this framework instead of doing a point estimate for the network parameters we infer a posterior distribution. These distributions capture the parameter uncertainty of the network, and by subsequently integrating over them we can obtain better uncertainties about the predictions of the model. We can see that this is indeed the case at Figure 1b; the confidence of the network for the unseen digits is drastically reduced when we are using a Bayesian model, thus resulting into more realistic predictive distributions. Obtaining the posterior distributions is however no easy task, as the nonlinear nature of neural networks makes the problem intractable. For this reason approximations have to be made.\nMany works have considered the task of approximate Bayesian inference for neural networks using either Markov Chain Monte Carlo (MCMC) with Hamiltonian Dynamics (Neal, 1995), distilling SGD with Langevin Dynamics (Welling & Teh, 2011; Korattikara et al., 2015) or deterministic techniques such as the Laplace Approximation (MacKay, 1992), Expectation Propagation (Hernández-Lobato & Adams, 2015; HernándezLobato et al., 2015) and variational inference (Graves, 2011; Blundell et al., 2015; Kingma et al., 2015; Gal & Ghahramani, 2015b; Louizos & Welling, 2016).\nIn this paper we will also tackle the problem of Bayesian inference in neural networks. We will adopt a stochastic gradient variational inference (Kingma & Welling, 2014; Rezende et al., 2014) procedure in order to estimate the posterior distribution over the weight matrices of the network. Arguably one of the most important ingredients of variational inference is the flexibility of the approximate posterior distribution; it determines how well we are able to capture the true posterior distribution and thus the true uncertainty of our models. In Section 2 we will show how we can produce very flexible distributions in an efficient way by employing auxiliary random variables (Agakov & Barber, 2004; Salimans et al., 2013; Ranganath et al., 2015; Maaløe et al., 2016) and normalizing flows (Rezende & Mohamed, 2015). In Section 3 we will discuss related\nwork, whereas in Section 4 we will evaluate and discuss the proposed framework. Finally we will conclude with Section 5, where we will provide some final thoughts along with promising directions for future research."
  }, {
    "heading": "2. Multiplicative normalizing flows",
    "text": ""
  }, {
    "heading": "2.1. Variational inference for Bayesian Neural Networks",
    "text": "Let D be a dataset consisting of input output pairs {(x1,y1), . . . , (xn,yn)} and let W1:L denote the weight matrices of L layers. Assuming that p(Wi), qφ(Wi) are the prior and approximate posterior over the parameters of the i’th layer we can derive the following lower bound on the marginal log-likelihood of the dataset D using variational Bayes (Peterson, 1987; Hinton & Van Camp, 1993; Graves, 2011; Blundell et al., 2015; Kingma et al., 2015; Gal & Ghahramani, 2015b; Louizos & Welling, 2016):\nL(φ) = Eqφ(W1:L) [ log p(y|x,W1:L)+\n+ log p(W1:L)− log qφ(W1:L) ] , (1)\nwhere p̃(x,y) denotes the training data distribution and φ the parameters of the variational posterior. For continuous q(·) distributions that allow for the reparametrization trick (Kingma & Welling, 2014) or stochastic backpropagation (Rezende et al., 2014) we can reparametrize the random sampling from q(·) of the lower bound in terms of noise variables and deterministic functions f(φ, ):\nL = Ep( ) [ log p(y|x, f(φ, ))+\n+ log p(f(φ, ))− log qφ(f(φ, )) ] . (2)\nThis reparametrization allow us to treat approximate parameter posterior inference as a straightforward optimiza-\ntion problem that can be optimized with off-the-shelf (stochastic) gradient ascent techniques."
  }, {
    "heading": "2.2. Improving the variational approximation",
    "text": "For Bayesian neural networks the most common family for the approximate posterior is that of mean field with independent Gaussian distributions for each weight. Despite the fact that this leads to a straightforward lower bound for optimization, the approximation capability is quite limiting; it corresponds to just a unimodal “bump” on the very high dimensional space of the parameters of the neural network. There have been attempts to improve upon this approximation with works such as (Gal & Ghahramani, 2015b) with mixtures of delta peaks and (Louizos & Welling, 2016) with matrix Gaussians that allow for nontrivial covariances among the weights. Nevertheless, both of the aforementioned methods are still, in a sense, limited; the true parameter posterior is more complex than delta peaks or correlated Gaussians.\nThere has been a lot of recent work on ways to improve the posterior approximation in latent variable models with normalizing flows (Rezende & Mohamed, 2015) and auxiliary random variables (Agakov & Barber, 2004; Salimans et al., 2013; Ranganath et al., 2015; Maaløe et al., 2016) being the most prominent. Briefly, a normalizing flow is constructed by introducing parametrized bijective transformations, with easy to compute Jacobians, to random variables with simple initial densities. By subsequently optimizing the parameters of the flow according to the lower bound they can significantly improve the posterior approximation. Auxiliary random variables instead construct more flexible distributions by introducing latent variables in the\nposterior itself, thus defining the approximate posterior as a mixture of simple distributions.\nNevertheless, applying these ideas to the parameters in a neural network has not yet been explored. While it is straightforward to apply normalizing flows to a sample of the weight matrix from q(W), this quickly becomes very expensive; for example with planar flows (Rezende & Mohamed, 2015) we will need two extra matrices for each step of the flow. Furthermore, by utilizing this procedure we also lose the benefits of local reparametrizations (Kingma et al., 2015; Louizos & Welling, 2016) which are possible with Gaussian approximate posteriors.\nIn order to simultaneously maintain the benefits of local reparametrizations and increase the flexibility of the approximate posteriors in a Bayesian neural network we will rely on auxiliary random variables (Agakov & Barber, 2004; Salimans et al., 2013; 2015; Ranganath et al., 2015; Maaløe et al., 2016); more specifically we will exploit the well known “multiplicative noise” concept, e.g. as in (Gaussian) Dropout (Srivastava et al., 2014), in neural networks and we will parametrize the approximate posterior with the following process:\nz ∼ qφ(z); W ∼ qφ(W|z), (3)\nwhere now the approximate posterior becomes a compound distribution, q(W) = ∫ q(W|z)q(z)dz, with z being a vector of random variables distributed according to the mixing density q(z). To allow for local reparametrizations we will parametrize the conditional distribution for the weights to be a fully factorized Gaussian. Therefore we assume the following form for the fully connected layers:\nqφ(W|z) = Din∏ i=1 Dout∏ j=1 N (ziµij , σ2ij), (4)\nwhere Din, Dout is the input and output dimensionality, and the following form for the kernels in convolutional networks:\nqφ(W|z) = Dh∏ i=1 Dw∏ j=1 Df∏ k=1 N (zkµijk, σ2ijk), (5)\nwhere Dh, Dw, Df are the height, width and number of filters for each kernel. Note that we did not let z affect the variance of the Gaussian approximation; in a pilot study we found that this parametrization was prone to local optima due to large variance gradients, an effect also observed with the multiplicative parametrization of the Gaussian posterior (Kingma et al., 2015; Molchanov et al., 2017). We have now reduced the problem of increasing the flexibility of the approximate posterior over the weights W to that of increasing the flexibility of the mixing density q(z). Since\nz is of much lower dimension, compared to W, it is now straightforward to apply normalizing flows to q(z); in this way we can significantly enhance our approximation and allow for e.g. multimodality and nonlinear dependencies between the elements of the weight matrix. This will in turn better capture the properties of the true posterior distribution, thus leading to better performance and predictive uncertainties. We will coin the term multiplicative normalizing flows (MNFs) for this family of approximate posteriors. Algorithms 1, 2 describe the forward pass using local reparametrizations for fully connected and convolutional layers with this type of approximate posterior.\nAlgorithm 1 Forward propagation for each fully connected layer h. Mw,Σw are the means and variances of each layer, H is a minibatch of activations and NF(·) is the normalizing flow described at eq. 6. For the first layer we have that H = X where X is the minibatch of inputs.\nRequire: H,Mw,Σw 1: Z0 ∼ q(z0) 2: ZTf = NF(Z0) 3: Mh = (H ZTf )Mw 4: Vh = H2Σw 5: E ∼ N (0, 1) 6: return Mh + √ Vh E\nAlgorithm 2 Forward propagation for each convolutional layer h. Nf are the number of convolutional filters, ∗ is the convolution operator and we assume the [batch, height, width, feature maps] convention.\nRequire: H,Mw,Σw 1: z0 ∼ q(z0) 2: zTf = NF(z0) 3: Mh = H ∗ (Mw reshape(zTf , [1, 1, Df ])) 4: Vh = H2 ∗Σw 5: E ∼ N (0, 1) 6: return Mh + √ Vh E\nFor the normalizing flow of q(z) we will use the masked RealNVP (Dinh et al., 2016) using the numerically stable updates introduced in Inverse Autoregressive Flow (IAF) (Kingma et al., 2016):\nm ∼ Bern(0.5); h = tanh(f(m zt)) µ = g(h); σ = σ(k(h))\nzt+1 = m zt+(1−m) (zt σ + (1− σ) µ) (6)\nlog ∣∣∣∣∂zt+1∂zt ∣∣∣∣ = (1−m)T logσ,\nwhere corresponds to element-wise multiplication, σ(·)\nis the sigmoid function1 and f(·), g(·), k(·) are linear mappings. We resampled the mask m every time in order to avoid a specific splitting over the dimensions of z. For the starting point of the flow q(z0) we used a simple fully factorized Gaussian and we will refer to the final iterate as zTf ."
  }, {
    "heading": "2.3. Bounding the entropy",
    "text": "Unfortunately, parametrizing the posterior distribution as eq. 3 makes the lower bound intractable as generally we do not have a closed form density function for q(W). This makes the calculation of the entropy −Eq(W)[log q(W)] challenging. Fortunately we can make the lower bound tractable again by further lower bounding the entropy in terms of an auxiliary distribution r(z|W) (Agakov & Barber, 2004; Salimans et al., 2013; 2015; Ranganath et al., 2015; Maaløe et al., 2016). This can be seen as if we are performing variational inference on the augmented probability space p(D,W1:L, z1:L), that maintains the same true posterior distribution p(W|D) (as we can always marginalize out r(z|W) to obtain the original model). The lower bound in this case becomes:\nL(φ, θ) = Eqφ(z1:L,W1:L) [ log p(y|x,W1:L, z1:L)+\n+ log p(W1:L) + log rθ(z1:L|W1:L)− − log qφ(W1:L|z1:L)− log qφ(z1:L) ] , (7)\nwhere θ are the parameters of the auxiliary distribution r(·). This bound is looser than the previous bound, however the extra flexibility of q(W) can compensate and allow for a tighter bound. Furthermore, the tightness of the bound also depends on the ability of r(z|W) to approximate the “auxiliary” posterior distribution q(z|W) = q(W|z)q(z)q(W) . Therefore, to allow for a flexible r(z|W) we will follow (Ranganath et al., 2015) and we will parametrize it with inverse normalizing flows as follows:\nr(zTb |W) = Dz∏ i=1 N (µ̃i, σ̃2i ), (8)\nwhere for fully connected layers we have that: µ̃i = ( b1 ⊗ tanh(cTW) ) (1 D−1out) (9)\nσ̃i = σ (( b2 ⊗ tanh(cTW) ) (1 D−1out) ) , (10)\nand for convolutional: µ̃i = ( tanh(mat(W)c)⊗ b1 ) (1 (DhDw)−1) (11)\nσ̃i = σ (( tanh(mat(W)c)⊗ b2 ) (1 (DhDw)−1) ) ,\n(12)\n1f(x) = 1 1+exp(−x)\nwhere b1,b2, c are trainable vectors that have the same dimensionality as z, Dz , 1 corresponds to a vector of 1s, ⊗ corresponds to the outer product and mat(·) corresponds to the matricization2 operator. The zTb variable corresponds to the fully factorized variable that is transformed by a normalizing flow to zTf or else the variable obtained by the inverse normalizing flow, zTb = NF\n−1(zTf ). We will parametrize this inverse directly with the procedure described at eq. 6. Notice that we can employ local reparametrizations also in eq. 9,10,11,12, so as to avoid sampling the, potentially big, matrix W. With the standard normal prior and the fully factorized Gaussian posterior of eq. 4 the KL-divergence between the prior and the posterior can be computed as follows:\n−KL(q(W)||p(W)) = = Eq(W,zT )[−KL(q(W|zTf )||p(W))+ + log r(zTf |W)− log q(zTf )], (13)\nwhere each of the terms corresponds to:\n−KL(q(W|zTf )||p(W)) =\n= 1\n2 ∑ i,j (− log σ2i,j + σ2i,j + z2Tfiµ 2 i,j − 1) (14)\nlog r(zTf |W) = log r(zTb |W) + Tf+Tb∑ t=Tf log ∣∣∣∣∂zt+1∂zt ∣∣∣∣\n(15)\nlog q(zTf ) = log q(z0)− Tf∑ t=1 log ∣∣∣∣∂zt+1∂zt ∣∣∣∣. (16)\nIt should be noted that this bound is a generalization of the bound proposed by (Gal & Ghahramani, 2015b). We can arrive at the bound of (Gal & Ghahramani, 2015b) if we trivially parametrize the auxiliary model r(z|W) = q(z) (which provides a less tight bound (Ranganath et al., 2015)) use a standard normal prior for W, a Bernoulli q(z) with probability of success π and then let the variance of our conditional Gaussian q(W|z) go to zero. This will result into the lower bound being infinite due to the log of the variances; nevertheless since we are not optimizing over σ we can simply disregard those terms. After a little bit of algebra we can show that the only term that will remain in the KL-divergence between q(W) and p(W) will be the expectation of the trace of the square of the mean matrix3, i.e. Eq(z)[ 12 tr((diag(z)M)) T (diag(z)M))] = π2 ‖M‖ 2 2, with 1− π being the dropout rate.\nWe also found that in general it is beneficial to “constrain” the standard deviations σij of the conditional Gaussian posterior q(W|z) during the forward pass for the computation\n2Converting the multidimensional tensor to a matrix. 3The matrix that has M[i, j] = µij\nof the likelihood to a lower than the true range, e.g. [0, α] instead of the [0, 1] we have with a standard normal prior. This results into a small bias and a looser lower bound, however it helps in avoiding bad local minima in the variational objective. This is akin to the free bits objective described at (Kingma et al., 2016)."
  }, {
    "heading": "3. Related work",
    "text": "Approximate inference for Bayesian neural networks has been pioneered by (MacKay, 1992) and (Neal, 1995). Laplace approximation (MacKay, 1992) provides a deterministic approximation to the posterior that is easy to obtain; it is a Gaussian centered at the MAP estimate of the parameters with a covariance determined by the inverse of the Hessian of the log-likelihood. Despite the fact that it is straightforward to implement, its scalability is limited unless approximations are made, which generally reduces performance. Hamiltonian Monte Carlo (Neal, 1995) is so far the golden standard for approximate Bayesian inference; nevertheless it is also not scalable to large networks and datasets due to the fact that we have to explicitly store the samples from the posterior. Furthermore as it is an MCMC method, assessing convergence is non trivial. Nevertheless there is interesting work that tries to improve upon those issues with stochastic gradient MCMC (Chen et al.) and distillation methods (Korattikara et al., 2015).\nDeterministic methods for approximate inference in Bayesian neural networks have recently attained much attention. One of the first applications of variational inference in neural networks was in (Peterson, 1987) and (Hinton & Van Camp, 1993). More recently (Graves, 2011) proposed a practical method for variational inference in this setting with a simple (but biased) estimator for a fully factorized posterior distribution. (Blundell et al., 2015) improved upon this work with the unbiased estimator from (Kingma & Welling, 2014) and a scale mixture prior. (Hernández-Lobato & Adams, 2015) proposed to use Expectation Propagation (Minka, 2001) with fully factorized posteriors and showed good results on regression tasks. (Kingma et al., 2015) showed how Gaussian dropout can be interpreted as performing approximate inference with log-uniform priors, multiplicative Gaussian posteriors and local reparametrizations, thus allowing straightforward learning of the dropout rates. Similarly (Gal & Ghahramani, 2015b) showed interesting connections between Bernoulli Dropout (Srivastava et al., 2014) networks and approximate Bayesian inference in deep Gaussian Processes (Damianou & Lawrence, 2013) thus allowing the extraction of uncertainties in a principled way. Similarly (Louizos & Welling, 2016) arrived at the same result through structured posterior approximations via matrix Gaussians and local reparametrizations (Kingma et al.,\n2015).\nIt should also be mentioned that uncertainty estimation in neural networks can also be performed without the Bayesian paradigm; frequentist methods such as Bootstrap (Osband et al., 2016) and ensembles (Lakshminarayanan et al., 2016) have shown that in certain scenarios they can provide reasonable confidence intervals."
  }, {
    "heading": "4. Experiments",
    "text": "All of the experiments were coded in Tensorflow (Abadi et al., 2016) and optimization was done with Adam (Kingma & Ba, 2015) using the default hyperparameters. We used the LeNet 54 (LeCun et al., 1998) convolutional architecture with ReLU (Nair & Hinton, 2010) nonlinearities. The means M of the conditional Gaussian q(W|z) were initialized with the scheme proposed in (He et al., 2015), whereas the log of the variances were initialized by sampling from N (−9, 0.001). Unless explicitly mentioned otherwise we use flows of length two for q(z) and r(z|W) with 50 hidden units for each step of the flow of q(z) and 100 hidden units for each step of the flow of r(z|W). We used 100 posterior samples to estimate the predictive distribution for all of the models during testing and 1 posterior sample during training."
  }, {
    "heading": "4.1. Predictive performance and uncertainty",
    "text": "MNIST We trained on MNIST LeNet architectures using the priors and posteriors described at Table 1. We trained Dropout with the way described at (Gal & Ghahramani, 2015a) using 0.5 for the dropout rate and for Deep Ensembles (Lakshminarayanan et al., 2016) we used 10 members and = .25 for the adversarial example generation. For the models with the Gaussian prior we constrained the standard deviation of the conditional posterior to be ≤ .5\n4The version from Caffe.\nduring the forward pass. The classification performance of each model can be seen at Table 2; while our overall focus is not classification accuracy per se, we see that with the MNF posteriors we improve upon mean field reaching similar accuracies with Deep Ensembles.\nnotMNIST To evaluate the predictive uncertainties of each model we performed the task described at (Lakshminarayanan et al., 2016); we estimated the entropy of the predictive distributions on notMNIST5 from the LeNet architectures trained on MNIST. Since we a-priori know that none of the notMNIST classes correspond to a trained class (since they are letters and not digits) the ideal predictive distribution is uniform over the MNIST digits, i.e. a maximum entropy distribution. Contrary to (Lakshminarayanan et al., 2016) we do not plot the histogram of the entropies across the images but we instead use the empirical CDF, which we think is more informative. Curves that are closer to the bottom right part of the plot are preferable, as it denotes that the probability of observing a high confidence prediction is low. At Figure 2 we show the empirical CDF over the range of possible entropies, [0, 2.5], for all of the models.\nIt is clear from the plot that the uncertainty estimates from MNFs are better than the other approaches, since the probability of a low entropy prediction is overall lower. The network trained with just weight decay was, as expected, the most overconfident with an almost zero median entropy while Dropout seems to be in the middle ground. The Bayesian neural net with the log-uniform prior also showed overconfidence in this task; we hypothesize that this is due to the induced sparsity (Molchanov et al., 2017) which results into the pruning of almost all irrelevant sources of variation in the parameters thus not providing enough vari-\n5Can be found at http://yaroslavvb.blogspot. co.uk/2011/09/notmnist-dataset.html\nability to allow for uncertainty in the predictions. The sparsity levels6 are 62%, 95.2% for the two convolutional layers and 99.5%, 93.3% for the two fully connected. Similar effects would probably be also observed if we optimized the dropout rates for Dropout. The only source of randomness in the neural network is from the Bernoulli random variables (r.v.) z. By employing the Central Limit Theorem7 we can express the distribution of the activations as a Gaussian (Wang & Manning, 2013) with variance affected by the variance of the Bernoulli r.v., V(z) = π(1−π). The maximum variance of the Bernoulli r.v. is when π = 0.5, therefore any tuning of the Dropout rate will result into a decrease in the variance of the r.v. and therefore a decrease in the variance of the Gaussian at the hidden units. This will subsequently lead into less predictive variance and more confidence.\nFinally, whereas it was shown at (Lakshminarayanan et al., 2016) that Deep Ensembles provide good uncertainty estimates (better than Dropout) on this task using fully connected networks, this result did not seem to apply for the LeNet architecture we considered. We hypothesize that they are sensitive to the hyperparameters (e.g. adversarial noise, number of members in the ensemble) and it requires more tuning in order to improve upon Dropout on this architecture.\nCIFAR 10 We performed a similar experiment on CIFAR 10. To artificially create the ”unobserved class” scenario, we hid 5 of the labels (dog, frog, horse, ship, truck) and trained on the rest (airplane, automobile, bird, cat, deer). For this task we used the larger LeNet architecture8 described at (Gal & Ghahramani, 2015a). For the models with the Gaussian prior we similarly constrained the standard deviation during the forward pass to be≤ .4. For Deep Ensembles we used five members with = .1 for the adversarial example generation. The predictive performance on these five classes can be seen in Table 2, with Dropout and MNFs achieving the overall better accuracies. We subsequently measured the entropy of the predictive distribution on the classes that were hidden, with the resulting empirical CDFs visualized in Figure 3.\nWe similarly observe that the network with just weight decay was the most overconfident. Furthermore, Deep Ensembles and Dropout had similar uncertainties, with Deep Ensembles having lower accuracy on the observed classes. The networks with the Gaussian priors also had similar uncertainty with the network with the log uniform prior, nevertheless the MNF posterior had much better accuracy on\n6Computed by pruning weights where log σ2 − logµ2 ≥ 5 (Molchanov et al., 2017).\n7Assuming that the network is wide enough. 8192 filters at each convolutional layer and 1000 hidden units\nfor the fully connected layer.\nthe observed classes. The sparsity levels for the network with the log-uniform prior now were 94.9%, 99.8% for the convolutional layers and 99.9%, 92.7% for the fully connected. Overall, the network with the MNF posteriors seem to provide the better trade-off in uncertainty and accuracy on the observed classes."
  }, {
    "heading": "4.2. Accuracy and uncertainty on adversarial examples",
    "text": "We also measure how robust our models and uncertainties are against adversarial examples (Szegedy et al., 2013; Goodfellow et al., 2014) by generating examples using the fast sign method (Goodfellow et al., 2014) for each of the previously trained architectures using Cleverhans (Papernot et al., 2016). For this task we do not include Deep Ensembles as they are trained on adversarial examples.\nMNIST On this scenario we observe interesting results if we plot the change in accuracy and entropy by varying the magnitude of the adversarial perturbation. The resulting plot can be seen in Figure 4. Overall Dropout seems to have better accuracies on adversarial examples; nevertheless, those come at an ”overconfident” price since the entropy of the predictive distributions is quite low thus resulting into predictions that have, on average, above 0.7 probability for the dominant class. This is in contrast with MNFs; while the accuracy almost immediately drops close to random, the uncertainty simultaneously increases to almost maximum entropy. This implies that the predictive distribution is more or less uniform over those examples. So despite the fact that our model cannot overcome adver-\nsarial examples at least it “knows that it doesn’t know”.\nCIFAR We performed the same experiment also on the five class subset of CIFAR 10. The results can be seen in Figure 5. Here we however observe a different picture, compared to MNIST, since all of the methods experienced overconfidence. We hypothesize that adversarial examples are harder to escape and be uncertain about in this dataset, due to the higher dimensionality, and therefore further investigation is needed."
  }, {
    "heading": "4.3. Regression on toy dataset",
    "text": "For the final experiment we visualize the predictive distributions obtained with the different models on the toy regression task introduced at (Hernández-Lobato & Adams, 2015). We generated 20 training inputs from U [−4, 4] and then obtained the corresponding targets via y = x3 + , where ∼ N (0, 9). We fixed the likelihood noise to its true value and then fitted a Dropout network with π = 0.5\nfor the hidden layer9, an FFLU network and an MNFG. We also fitted a Dropout network where we also learned the dropout probability π of the hidden layer according to the bound described at section 2.3 (which is equivalent to the one described at (Gal & Ghahramani, 2015b)) using REINFORCE (Williams, 1992) and a global baseline (Mnih & Gregor, 2014). The resulting predictive distributions can be seen at Figure 6.\nAs we can observe, MNF posteriors provide more realistic predictive distributions, closer to the true posterior (which can be seen at (Hernández-Lobato & Adams, 2015)) and with the network being more uncertain on areas where we do not observed any data. The uncertainties obtained by Dropout with fixed π = 0.5 did not diverge as much in those areas but overall they were better compared to the uncertainties obtained with FFLU. We could probably attribute the latter to the sparsification of the network since 95% and 44% of the parameters were pruned for each layer respectively.\nInterestingly the uncertainties obtained with the network with the learned Dropout probability were the most “overfitted”. This might suggest that Dropout uncertainty is probably not a good posterior approximation since by optimizing the dropout rates we do not seem to move closer to the true posterior predictive distribution. This is in contrast with MNFs; they are flexible enough to allow for optimizing all of their parameters in a way that does better approximate the true posterior distribution. This result also empirically verifies the claim we previously made; by learning the dropout rates the entropy of the posterior predictive will decrease thus resulting into more overconfident predictions."
  }, {
    "heading": "5. Conclusion",
    "text": "We introduce multiplicative normalizing flows (MNFs); a family of approximate posteriors for the parameters of a variational Bayesian neural network. We have shown that through this approximation we can significantly improve upon mean field on both predictive performance as\n9No Dropout was used for the input layer since it is 1- dimensional.\nwell as predictive uncertainty. We compared our uncertainty on notMNIST and CIFAR with Dropout (Srivastava et al., 2014; Gal & Ghahramani, 2015b) and Deep Ensembles (Lakshminarayanan et al., 2016) using convolutional architectures and found that MNFs achieve more realistic uncertainties while providing predictive capabilities on par with Dropout. We suspect that the predictive capabilities of MNFs can be further improved through more appropriate optimizers that avoid the bad local minima in the variational objective. Finally, we also highlighted limitations of Dropout approximations and empirically showed that MNFs can overcome them.\nThere are a couple of promising directions for future research. One avenue would be to explore how much can MNFs sparsify and compress neural networks under either sparsity inducing priors, such as the log-uniform prior (Kingma et al., 2015; Molchanov et al., 2017), or empirical priors (Ullrich et al., 2017). Another promising direction is that of designing better priors for Bayesian neural networks. For example (Neal, 1995) has identified limitations of Gaussian priors and proposes alternative priors such as the Cauchy. Furthermore, the prior over the parameters also affects the type of uncertainty we get in our predictions; for instance we observed in our experiments a significant difference in uncertainty between Gaussian and log-uniform priors. Since different problems require different types of uncertainty it makes sense to choose the prior accordingly, e.g. use an informative prior so as to alleviate adversarial examples."
  }, {
    "heading": "Acknowledgements",
    "text": "We would like to thank Klamer Schutte, Matthias Reisser and Karen Ullrich for valuable feedback. This research is supported by TNO, NWO and Google."
  }],
  "year": 2017,
  "references": [{
    "title": "An auxiliary variational method",
    "authors": ["Agakov", "Felix V", "Barber", "David"],
    "venue": "In International Conference on Neural Information Processing,",
    "year": 2004
  }, {
    "title": "Weight uncertainty in neural networks",
    "authors": ["Blundell", "Charles", "Cornebise", "Julien", "Kavukcuoglu", "Koray", "Wierstra", "Daan"],
    "venue": "Proceedings of the 32nd International Conference on Machine Learning, ICML 2015,",
    "year": 2015
  }, {
    "title": "Deep gaussian processes",
    "authors": ["Damianou", "Andreas C", "Lawrence", "Neil D"],
    "venue": "In Proceedings of the Sixteenth International Conference on Artificial Intelligence and Statistics,",
    "year": 2013
  }, {
    "title": "Density estimation using real nvp",
    "authors": ["Dinh", "Laurent", "Sohl-Dickstein", "Jascha", "Bengio", "Samy"],
    "venue": "arXiv preprint arXiv:1605.08803,",
    "year": 2016
  }, {
    "title": "Bayesian convolutional neural networks with bernoulli approximate variational inference",
    "authors": ["Gal", "Yarin", "Ghahramani", "Zoubin"],
    "venue": "arXiv preprint arXiv:1506.02158,",
    "year": 2015
  }, {
    "title": "Dropout as a bayesian approximation: Representing model uncertainty in deep learning",
    "authors": ["Gal", "Yarin", "Ghahramani", "Zoubin"],
    "venue": "arXiv preprint arXiv:1506.02142,",
    "year": 2015
  }, {
    "title": "Explaining and harnessing adversarial examples",
    "authors": ["Goodfellow", "Ian J", "Shlens", "Jonathon", "Szegedy", "Christian"],
    "venue": "arXiv preprint arXiv:1412.6572,",
    "year": 2014
  }, {
    "title": "Practical variational inference for neural networks",
    "authors": ["Graves", "Alex"],
    "venue": "In Advances in Neural Information Processing Systems,",
    "year": 2011
  }, {
    "title": "Delving deep into rectifiers: Surpassing humanlevel performance on imagenet classification",
    "authors": ["He", "Kaiming", "Zhang", "Xiangyu", "Ren", "Shaoqing", "Sun", "Jian"],
    "venue": "In Proceedings of the IEEE International Conference on Computer Vision, pp",
    "year": 2015
  }, {
    "title": "Probabilistic backpropagation for scalable learning of bayesian neural networks",
    "authors": ["Hernández-Lobato", "José Miguel", "Adams", "Ryan"],
    "venue": "In Proceedings of the 32nd International Conference on Machine Learning, ICML 2015,",
    "year": 2015
  }, {
    "title": "Black-box α-divergence minimization",
    "authors": ["E. Richard"],
    "venue": "arXiv preprint arXiv:1511.03243,",
    "year": 2015
  }, {
    "title": "Keeping the neural networks simple by minimizing the description length of the weights",
    "authors": ["Hinton", "Geoffrey E", "Van Camp", "Drew"],
    "venue": "In Proceedings of the sixth annual conference on Computational learning theory,",
    "year": 1993
  }, {
    "title": "Adam: A method for stochastic optimization",
    "authors": ["Kingma", "Diederik", "Ba", "Jimmy"],
    "venue": "International Conference on Learning Representations (ICLR), San Diego,",
    "year": 2015
  }, {
    "title": "Auto-encoding variational bayes",
    "authors": ["Kingma", "Diederik P", "Welling", "Max"],
    "venue": "International Conference on Learning Representations (ICLR),",
    "year": 2014
  }, {
    "title": "Variational dropout and the local reparametrization trick",
    "authors": ["Kingma", "Diederik P", "Salimans", "Tim", "Welling", "Max"],
    "venue": "Advances in Neural Information Processing Systems,",
    "year": 2015
  }, {
    "title": "Improving variational inference with inverse autoregressive flow",
    "authors": ["Kingma", "Diederik P", "Salimans", "Tim", "Welling", "Max"],
    "venue": "arXiv preprint arXiv:1606.04934,",
    "year": 2016
  }, {
    "title": "Bayesian dark knowledge",
    "authors": ["Korattikara", "Anoop", "Rathod", "Vivek", "Murphy", "Kevin", "Welling", "Max"],
    "venue": "arXiv preprint arXiv:1506.04416,",
    "year": 2015
  }, {
    "title": "Simple and scalable predictive uncertainty estimation using deep ensembles",
    "authors": ["Lakshminarayanan", "Balaji", "Pritzel", "Alexander", "Blundell", "Charles"],
    "venue": "arXiv preprint arXiv:1612.01474,",
    "year": 2016
  }, {
    "title": "Gradient-based learning applied to document recognition",
    "authors": ["LeCun", "Yann", "Bottou", "Léon", "Bengio", "Yoshua", "Haffner", "Patrick"],
    "venue": "Proceedings of the IEEE,",
    "year": 1998
  }, {
    "title": "Structured and efficient variational deep learning with matrix gaussian posteriors",
    "authors": ["Louizos", "Christos", "Welling", "Max"],
    "venue": "arXiv preprint arXiv:1603.04733,",
    "year": 2016
  }, {
    "title": "Auxiliary deep generative models",
    "authors": ["Maaløe", "Lars", "Sønderby", "Casper Kaae", "Søren Kaae", "Winther", "Ole"],
    "venue": "arXiv preprint arXiv:1602.05473,",
    "year": 2016
  }, {
    "title": "A practical bayesian framework for backpropagation networks",
    "authors": ["MacKay", "David JC"],
    "venue": "Neural computation,",
    "year": 1992
  }, {
    "title": "Expectation propagation for approximate bayesian inference",
    "authors": ["Minka", "Thomas P"],
    "venue": "In Proceedings of the Seventeenth conference on Uncertainty in artificial intelligence,",
    "year": 2001
  }, {
    "title": "Neural variational inference and learning in belief networks",
    "authors": ["Mnih", "Andriy", "Gregor", "Karol"],
    "venue": "arXiv preprint arXiv:1402.0030,",
    "year": 2014
  }, {
    "title": "Rectified linear units improve restricted boltzmann machines",
    "authors": ["Nair", "Vinod", "Hinton", "Geoffrey E"],
    "venue": "In Proceedings of the 27th International Conference on Machine Learning",
    "year": 2010
  }, {
    "title": "Bayesian learning for neural networks",
    "authors": ["Neal", "Radford M"],
    "venue": "PhD thesis, Citeseer,",
    "year": 1995
  }, {
    "title": "Deep exploration via bootstrapped dqn",
    "authors": ["Osband", "Ian", "Blundell", "Charles", "Pritzel", "Alexander", "Van Roy", "Benjamin"],
    "venue": "arXiv preprint arXiv:1602.04621,",
    "year": 2016
  }, {
    "title": "cleverhans v1.0.0: an adversarial machine learning library",
    "authors": ["Papernot", "Nicolas", "Goodfellow", "Ian", "Sheatsley", "Ryan", "Feinman", "Reuben", "McDaniel", "Patrick"],
    "venue": "arXiv preprint arXiv:1610.00768,",
    "year": 2016
  }, {
    "title": "A mean field theory learning algorithm for neural networks",
    "authors": ["Peterson", "Carsten"],
    "venue": "Complex systems,",
    "year": 1987
  }, {
    "title": "Hierarchical variational models",
    "authors": ["Ranganath", "Rajesh", "Tran", "Dustin", "Blei", "David M"],
    "venue": "arXiv preprint arXiv:1511.02386,",
    "year": 2015
  }, {
    "title": "Variational inference with normalizing flows",
    "authors": ["Rezende", "Danilo Jimenez", "Mohamed", "Shakir"],
    "venue": "arXiv preprint arXiv:1505.05770,",
    "year": 2015
  }, {
    "title": "Stochastic backpropagation and approximate inference in deep generative models",
    "authors": ["Rezende", "Danilo Jimenez", "Mohamed", "Shakir", "Wierstra", "Daan"],
    "venue": "In Proceedings of the 31th International Conference on Machine Learning,",
    "year": 2014
  }, {
    "title": "Fixed-form variational posterior approximation through stochastic linear regression",
    "authors": ["Salimans", "Tim", "Knowles", "David A"],
    "venue": "Bayesian Analysis,",
    "year": 2013
  }, {
    "title": "Markov chain monte carlo and variational inference: Bridging the gap",
    "authors": ["Salimans", "Tim", "Kingma", "Diederik P", "Welling", "Max"],
    "venue": "In International Conference on Machine Learning,",
    "year": 2015
  }, {
    "title": "Dropout: A simple way to prevent neural networks from overfitting",
    "authors": ["Srivastava", "Nitish", "Hinton", "Geoffrey", "Krizhevsky", "Alex", "Sutskever", "Ilya", "Salakhutdinov", "Ruslan"],
    "venue": "The Journal of Machine Learning Research,",
    "year": 1929
  }, {
    "title": "Intriguing properties of neural networks",
    "authors": ["Szegedy", "Christian", "Zaremba", "Wojciech", "Sutskever", "Ilya", "Bruna", "Joan", "Erhan", "Dumitru", "Goodfellow", "Ian", "Fergus", "Rob"],
    "venue": "arXiv preprint arXiv:1312.6199,",
    "year": 2013
  }, {
    "title": "Soft weight-sharing for neural network compression",
    "authors": ["Ullrich", "Karen", "Meeds", "Edward", "Welling", "Max"],
    "venue": "arXiv preprint arXiv:1702.04008,",
    "year": 2017
  }, {
    "title": "Fast dropout training",
    "authors": ["Wang", "Sida", "Manning", "Christopher"],
    "venue": "In Proceedings of The 30th International Conference on Machine Learning,",
    "year": 2013
  }, {
    "title": "Bayesian learning via stochastic gradient langevin dynamics",
    "authors": ["Welling", "Max", "Teh", "Yee W"],
    "venue": "In Proceedings of the 28th International Conference on Machine Learning",
    "year": 2011
  }, {
    "title": "Simple statistical gradient-following algorithms for connectionist reinforcement learning",
    "authors": ["Williams", "Ronald J"],
    "venue": "Machine learning,",
    "year": 1992
  }, {
    "title": "Understanding deep learning requires rethinking generalization",
    "authors": ["Zhang", "Chiyuan", "Bengio", "Samy", "Hardt", "Moritz", "Recht", "Benjamin", "Vinyals", "Oriol"],
    "venue": "arXiv preprint arXiv:1611.03530,",
    "year": 2016
  }],
  "id": "SP:b5fa038000a81e55f1160136f401a9cde3be2f71",
  "authors": [{
    "name": "Christos Louizos",
    "affiliations": []
  }, {
    "name": "Max Welling",
    "affiliations": []
  }],
  "abstractText": "We reinterpret multiplicative noise in neural networks as auxiliary random variables that augment the approximate posterior in a variational setting for Bayesian neural networks. We show that through this interpretation it is both efficient and straightforward to improve the approximation by employing normalizing flows (Rezende & Mohamed, 2015) while still allowing for local reparametrizations (Kingma et al., 2015) and a tractable lower bound (Ranganath et al., 2015; Maaløe et al., 2016). In experiments we show that with this new approximation we can significantly improve upon classical mean field for Bayesian neural networks on both predictive accuracy as well as predictive uncertainty.",
  "title": "Multiplicative Normalizing Flows for Variational Bayesian Neural Networks"
}